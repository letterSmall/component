{%- assign customDesc = product.metafields.custom_desc -%}
{% capture form_id %}AddToCartForm-{{ section_id }}{% endcapture %}
{% form 'product', product, id: form_id, class: 'product-single__form' %}
  {% comment %}
    Automatically inserted by Shop Pay Installments theme updater
  {% endcomment %}
  {% unless settings.disable_autogenerated_payment_terms %}
    {{ form | payment_terms }}
  {% endunless %}

  {% unless product.has_only_default_variant %}
<div class="product-variant-box">
{%assign option_size=0%}
   {%- for option in product.options_with_values -%}
  {%assign option_size=option_size|plus:1%}
  {%endfor%}
   {%assign option_size_minus=option_size|minus:1%}
  
    {%- for option in product.options_with_values -%}
 
{%assign index=forloop.index%}
      {%- if settings.product_color_swatches -%}
        {%- assign is_color = false -%}
        {%- assign color_option_index = 0 -%}
        {%- assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase-%}
        {%- assign color_option_index = forloop.index0 -%}
        {%- assign downcased_option = option.name | downcase -%}
        {%- if downcased_option contains swatch_trigger -%}
          {%- assign is_color = true -%}
        {%- elsif swatch_trigger == 'color' and downcased_option contains 'colour' -%}
          {%- assign is_color = true -%}
        {%- endif -%}
      {%- endif -%}

    
       
     {%if forloop.last%}
        {% render 'variant-dropdown',
          section_id: section_id,
          option: option,
          option_size_minus:option_size_minus,
          forloop: forloop
        %}
{%else%}
 {% render 'variant-button',
          section_id: section_id,
          option: option,
          forloop: forloop,
          is_color: is_color,
          option_size_minus:option_size_minus,
          color_option_index: color_option_index
        %}
      {% endif %}

    {%- endfor -%}
  </div>
  {% endunless %}

<label for="ProductSelect-{{ section_id }}" class="hidden-label">Select Product Variant</label>
  <select name="id" id="ProductSelect-{{ section_id }}" class="product-single__variants no-js">
    {% for variant in product.variants %}
      {% if variant.available %}
        <option {% if variant == product.selected_or_first_available_variant %}
          selected="selected" {% endif %}
          value="{{ variant.id }}">
          {{ variant.title }} - {{ variant.price | money_with_currency }}
        </option>
      {% else %}
        <option disabled="disabled">
          {{ variant.title }} - {{ 'products.product.sold_out' | t }}
        </option>
      {% endif %}
    {% endfor %}
  </select>


<div class="product__buy-box">
  {% if settings.quantity_enable %}
    <div class="product__quantity product__quantity--{{ settings.variant_type }}">
<!--       <label for="Quantity-{{ section_id }}">{{ 'products.product.quantity' | t }}</label> -->
      {% render 'quantity-input', id: section_id, qty: 1, min: 1 %}
    </div>
  {% endif %}


 {%- assign button_text = 'products.product.add_to_cart' | t -%}
    {%- if current_variant.available -%}
      {%- if template == 'product.preorder' -%}
        {%- assign button_text = 'products.product.preorder' | t -%}
      {%- endif -%}
    {%- else -%}
      {%- assign button_text = 'products.product.sold_out' | t -%}
    {%- endif -%}

    <button
      {% if product.empty? %}type="button"{% else %}type="submit"{% endif %}
      name="add"
      id="AddToCart-{{ section_id }}"
      class="{% if enable_dynamic_buttons %}btn--tertiary{% else %}btn{% endif %} btn--full btn--no-animate  product-add-to-cart add-to-cart"
      {% unless current_variant.available %} disabled="disabled"{% endunless %}>
      <span id="AddToCartText-{{ section_id }}" data-default-text="{{ button_text }}">
        {{ button_text }}
      </span>
    </button>

</div>
  
  {%- assign enable_dynamic_buttons = false -%}
  {% if settings.enable_payment_button and template != 'product.preorder' %}
    {%- assign enable_dynamic_buttons = true -%}
  {% endif %}

  {% if enable_dynamic_buttons %}
    <div class="payment-buttons">
  {% endif %}

   

    {% if enable_dynamic_buttons %}
      {{ form | payment_button }}
    {% endif %}

  {% if enable_dynamic_buttons %}
    </div>
  {% endif %}

 {%render "shipping-time"%}

{%if customDesc.additional_msg!=blank%}
            <div class="product-additional-msg">
             {{customDesc.additional_msg}}
            </div>
            {%endif%}
  <textarea id="VariantsJson-{{ section_id }}" class="hide" aria-hidden="true">
    {{ product.variants | json }}
  </textarea>
{%if customDesc.activity%}
<div class="activity-container">
   {{customDesc.activity}}
</div>
{%endif%}

  {% if product.options.size > 1 %}
    <textarea id="CurrentVariantJson-{{ section_id }}" class="hide" aria-hidden="true">
      {{ current_variant | json }}
    </textarea>
  {% endif %}
{% endform %}


<script>
  $('.product__buy-box').after($('shopify-payment-terms[variant-id]'));
  </script>
